<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>原生node api笔记 | Zhy Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="产生唯一 idnpm i uuid -D   12const uuid = require(&amp;apos;uuid&#x2F;v4&amp;apos;)console.log(uuid().replace(&#x2F;\-&#x2F;g, &amp;apos;&amp;apos;)) &#x2F;&#x2F; 把所有的 - 去掉  获取 后缀名12const path = require(&amp;apos;path&amp;apos;)let ext = path.extname(&amp;apos;xx.txt&amp;apos;) &#x2F;&#x2F; .txt  stream 减少内存占用">
<meta name="keywords" content="node api">
<meta property="og:type" content="article">
<meta property="og:title" content="原生node api笔记">
<meta property="og:url" content="https:&#x2F;&#x2F;liserlzhy.github.io&#x2F;2019&#x2F;10&#x2F;31&#x2F;node&#x2F;node-api&#x2F;index.html">
<meta property="og:site_name" content="Zhy Blog">
<meta property="og:description" content="产生唯一 idnpm i uuid -D   12const uuid = require(&amp;apos;uuid&#x2F;v4&amp;apos;)console.log(uuid().replace(&#x2F;\-&#x2F;g, &amp;apos;&amp;apos;)) &#x2F;&#x2F; 把所有的 - 去掉  获取 后缀名12const path = require(&amp;apos;path&amp;apos;)let ext = path.extname(&amp;apos;xx.txt&amp;apos;) &#x2F;&#x2F; .txt  stream 减少内存占用">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-11-24T14:21:19.478Z">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/blog/atom.xml" title="Zhy Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/blog/css/images/logo.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/blog/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="slideout-menu">
    <ul>
      
      <li>
        <a class="main-nav-link" href="/blog/">首页</a>
      </li>
      
      <li>
        <a class="main-nav-link" href="/blog/archives">归档</a>
      </li>
      
      <li>
        
  <div class="site_search">
   <div class="form-group">
    <input type="text" id="slidedown-search-input" name="q" results="0" placeholder="搜索" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="slidedown-search-result"></div>
  </div>

      </li>
    </ul>
  </div>
  <nav id="header-nav">
    <div id="logo-img">
      <label class="on-off noselect" for="on-off">
        <input id="on-off" type="checkbox" onchange="return window.location='/blog/'">
        <span class="on-off-circle"></span>
      </label>
    </div>
    <div id="menu-icon">
      <a class="icon icon-bars"></a>
    </div>
    <ul>
      
      <li>
        <a class="main-nav-link" href="/blog/">首页</a>
      </li>
      
      <li>
        <a class="main-nav-link" href="/blog/archives">归档</a>
      </li>
      
      <li>
        <div id="search-icon">
          <a class="icon icon-search" title="搜索"></a>
        </div>
      </li>
    </ul>
  </nav>
  
  <div class="site_search">
   <div>
    <input type="text" id="nav-search-input" name="q" results="0" placeholder="搜索"/>
   </div>  
  <div id="nav-search-result"></div>
  </div>

</header>
      <div class="outer">
        <div  class="toc-post" >

  <div id="toc" class="toc-article">
    <span id="toc-icon" class="icon icon-chevron-right"></span>
    <div id="toc-box">
        <div class="toc-title">目录</div>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#产生唯一-id"><span class="toc-text">产生唯一 id</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取-后缀名"><span class="toc-text">获取 后缀名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stream"><span class="toc-text">stream</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EventEmitter-事件队列"><span class="toc-text">EventEmitter 事件队列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS"><span class="toc-text">DNS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OS"><span class="toc-text">OS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Assertion-调试"><span class="toc-text">Assertion 调试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto-加密"><span class="toc-text">Crypto 加密</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Child-Process-多进程"><span class="toc-text">Child Process 多进程</span></a></li></ol>
    </div>
</div>

<article id="post-node/node-api" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <time class="article-date" datetime="2019-10-31T10:05:20.000Z" itemprop="datePublished">2019-10-31</time>

    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/node/">node</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      原生node api笔记
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="产生唯一-id"><a href="#产生唯一-id" class="headerlink" title="产生唯一 id"></a>产生唯一 id</h2><p><code>npm i uuid -D</code>  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> uuid = <span class="built_in">require</span>(<span class="string">'uuid/v4'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(uuid().replace(<span class="regexp">/\-/g</span>, <span class="string">''</span>)) <span class="comment">// 把所有的 - 去掉</span></span><br></pre></td></tr></table></figure>

<h2 id="获取-后缀名"><a href="#获取-后缀名" class="headerlink" title="获取 后缀名"></a>获取 后缀名</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">let</span> ext = path.extname(<span class="string">'xx.txt'</span>) <span class="comment">// .txt</span></span><br></pre></td></tr></table></figure>

<h2 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h2><ol>
<li>减少内存占用、增强系统性能（利用率高）</li>
<li>分3种：读取、写入、读写<ul>
<li>读取流：req、fs.createReadStream</li>
<li>写入流：res、fs.createWriteStream</li>
<li>读写流：zlib.createGzip</li>
</ul>
</li>
<li>把压缩文件发送到浏览器，需要设置响应头<ul>
<li>res.setHeader(‘Content-Encoding’, ‘gzip’)  <a id="more"></a>

</li>
</ul>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>(<span class="string">'zlib'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> gz = zlib.createGzip()</span><br><span class="line"><span class="comment">// 读写流：压缩，加密</span></span><br><span class="line"><span class="keyword">let</span> rs = fs.createReadStream(<span class="string">'www/1.html'</span>) <span class="comment">// 读取流</span></span><br><span class="line"><span class="keyword">let</span> ws = fs.createWriteStream(<span class="string">'www/2.html.gz'</span>) <span class="comment">// 写入流</span></span><br><span class="line"></span><br><span class="line">rs.pipe(gz).pipe(ws)</span><br><span class="line">rs.on(<span class="string">'error'</span>, err =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'读取失败'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">ws.on(<span class="string">'error'</span>, err =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'写入失败'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="EventEmitter-事件队列"><a href="#EventEmitter-事件队列" class="headerlink" title="EventEmitter 事件队列"></a>EventEmitter 事件队列</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Event = <span class="built_in">require</span>(<span class="string">'events'</span>).EventEmitter</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ev = <span class="keyword">new</span> Event()</span><br><span class="line"><span class="comment">// ev监听</span></span><br><span class="line">ev.on(<span class="string">'blu'</span>, (a, b, c) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'收到了'</span>, a, b, c)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ev触发</span></span><br><span class="line">ev.emit(<span class="string">'blu'</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">3</span>) <span class="comment">// 返回值为是否有对应监听</span></span><br></pre></td></tr></table></figure>
<h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dns = <span class="built_in">require</span>(<span class="string">'dns'</span>)</span><br><span class="line"><span class="keyword">let</span> ip = <span class="string">''</span></span><br><span class="line">dns.lookup(<span class="string">'www.badu.com'</span>, (err, data) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'wrong'</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ip = data</span><br><span class="line">        <span class="built_in">console</span>.log(data) <span class="comment">//输出百度的ip地址</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">dns.lookupService(ip, <span class="number">80</span>, (err, data) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="OS"><a href="#OS" class="headerlink" title="OS"></a>OS</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">'os'</span>)</span><br><span class="line"><span class="keyword">let</span> arr = os.cpus() <span class="comment">// cpu 信息</span></span><br><span class="line"><span class="keyword">let</span> free = os.freemem() <span class="comment">// 空闲内存</span></span><br></pre></td></tr></table></figure>
<h2 id="Assertion-调试"><a href="#Assertion-调试" class="headerlink" title="Assertion 调试"></a>Assertion 调试</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">divide</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    assert(<span class="keyword">typeof</span> a == <span class="string">'number'</span> &amp;&amp; <span class="keyword">typeof</span> b == <span class="string">'number'</span>, <span class="string">'都得是数字'</span>)</span><br><span class="line">    assert(b != <span class="number">0</span>, <span class="string">'分母不能为0'</span>)</span><br><span class="line">    <span class="keyword">return</span> a / b</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(divide(a, <span class="number">10</span>))</span><br></pre></td></tr></table></figure>
<h2 id="Crypto-加密"><a href="#Crypto-加密" class="headerlink" title="Crypto 加密"></a>Crypto 加密</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = requrie(<span class="string">'crypto'</span>)</span><br><span class="line"><span class="keyword">let</span> hash = crypto.createHash(<span class="string">'md5'</span>)</span><br><span class="line">hash.update(<span class="string">'sdl'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(hash.digest(<span class="string">'hex'</span>))</span><br></pre></td></tr></table></figure>
<h2 id="Child-Process-多进程"><a href="#Child-Process-多进程" class="headerlink" title="Child Process 多进程"></a>Child Process 多进程</h2><p>Cluster<br>Process </p>
<ul>
<li>只有系统才能完全全新创造进程</li>
<li>一个程序可以通过复制自己创造新的进程</li>
<li>子进程不能再创造进程</li>
<li>主进程和子进程之间能够共享句柄(socket端口)  </li>
</ul>
<pre><code class="js"><span class="keyword">const</span> cluster = <span class="built_in">require</span>(<span class="string">'cluster'</span>)
<span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">'os'</span>)
<span class="keyword">const</span> process = <span class="built_in">require</span>(<span class="string">'process'</span>) <span class="comment">// 进程信息</span>
<span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)

<span class="keyword">if</span> (cluster.isMaster) { <span class="comment">// 判断是否为主进程，若是主进程则分裂子进程</span>
    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; os.cpus().length; i++) {
        cluster.fork() 
    }
    <span class="built_in">console</span>.log(<span class="string">'主进程'</span>)
} <span class="keyword">else</span> {
    http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> {
        <span class="built_in">console</span>.log(<span class="string">`工作进程#<span class="subst">${process.pid}</span>`</span>)
    }).listen(<span class="number">3000</span>)
}</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liserlzhy.github.io/2019/10/31/node/node-api/" data-id="ck3d3c76f0004x4stgckf1zgq" class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/node-api/" rel="tag">node api</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/2019/10/31/hexo/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Hexo Hello World
        
      </div>
    </a>
  
  
    <a href="/blog/2019/09/18/js/js-exam/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">js试题</div>
    </a>
  
</nav>

  
</article>
</div>

<section id="comments">
  <div id="gitalk-container"></div>
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<div id="gitalk-container"></div>
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: 'c384627b91fb67b4d945',
        clientSecret: '40bcd6212e102325b854bae964674349cc49d136',
        id: window.location.pathname,
        repo: 'blog-comment',
        owner: 'liserlzhy',
        admin: 'liserlzhy'
    })
    gitalk.render('gitalk-container')
</script>
</section>



        <span id="toTopBtn" class="icon icon-angle-up"></span>
      </div>
      <footer id="footer">
  
<div id="right-footer">
  <div id="social-media-footer">
      <ul>
          <li>
              <a href="https://github.com/liserlzhy/blog" target="_blank" rel="noopener" class="icon icon-github"></a>
          </li>
      </ul>
  </div>
</div>
</footer>
    </div>
  </div>
  

<script src="/blog/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>


<script src="/blog/js/search.js"></script>

  <script type="text/javascript">      
    var search_path = "search.xml";
  if (search_path.length == 0) {
    search_path = "search.xml";
  }
  var path = "/blog/" + search_path;
    searchFunc(path, 'slidedown-search-input', 'slidedown-search-result');
    searchFunc(path, 'nav-search-input', 'nav-search-result');
  </script>


</body>
</html>