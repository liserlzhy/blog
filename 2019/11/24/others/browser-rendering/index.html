<!-- build time:Wed Nov 27 2019 10:46:41 GMT+0000 (Coordinated Universal Time) --><!DOCTYPE html><html><head><meta charset="utf-8"><title>Browser Rendering | Zhy Blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="从 HTML 原始字节到 DOMBytes =&amp;gt; Charaters =&amp;gt; Tokens =&amp;gt; Node =&amp;gt; DOMwhat is token?Essentially, an html file is broken down into small units of parsing called tokens.This is how the browser begins t"><meta property="og:type" content="article"><meta property="og:title" content="Browser Rendering"><meta property="og:url" content="https:&#x2F;&#x2F;liserlzhy.github.io&#x2F;2019&#x2F;11&#x2F;24&#x2F;others&#x2F;browser-rendering&#x2F;index.html"><meta property="og:site_name" content="Zhy Blog"><meta property="og:description" content="从 HTML 原始字节到 DOMBytes =&amp;gt; Charaters =&amp;gt; Tokens =&amp;gt; Node =&amp;gt; DOMwhat is token?Essentially, an html file is broken down into small units of parsing called tokens.This is how the browser begins t"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2019-11-27T10:46:21.136Z"><meta name="twitter:card" content="summary"><link rel="alternate" href="/blog/atom.xml" title="Zhy Blog" type="application/atom+xml"><link rel="icon" href="/blog/css/images/logo.png"><link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/blog/css/style.css"><meta name="generator" content="Hexo 4.0.0"></head></html><body ontouchstart><div id="container"><div id="wrap"><header id="header"><div id="slideout-menu"><ul><li><a class="main-nav-link" href="/blog/">首页</a></li><li><a class="main-nav-link" href="/blog/archives">归档</a></li><li><a class="main-nav-link" href="/blog/favorite">收藏</a></li><li><div class="site_search"><div class="form-group"><input type="text" id="slidedown-search-input" name="q" results="0" placeholder="搜索" class="st-search-input st-default-search-input form-control"></div><div id="slidedown-search-result"></div></div></li></ul></div><nav id="header-nav"><div id="logo-img"><label class="on-off noselect" for="on-off"><input id="on-off" type="checkbox" onchange='return window.location="/blog/"'> <span class="on-off-circle"></span></label></div><div id="menu-icon"><a class="icon icon-bars"></a></div><ul><li><a class="main-nav-link" href="/blog/">首页</a></li><li><a class="main-nav-link" href="/blog/archives">归档</a></li><li><a class="main-nav-link" href="/blog/favorite">收藏</a></li><li><div id="search-icon"><a class="icon icon-search" title="搜索"></a></div></li></ul></nav><div class="site_search"><div><input type="text" id="nav-search-input" name="q" results="0" placeholder="搜索"></div><div id="nav-search-result"></div></div></header><div class="outer"><div class="toc-post"><div id="toc" class="toc-article"><span id="toc-icon" class="icon icon-chevron-right"></span><div id="toc-box"><div class="toc-title">目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#从-HTML-原始字节到-DOM"><span class="toc-text">从 HTML 原始字节到 DOM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#从-CSS-原始字节到-CSSOM"><span class="toc-text">从 CSS 原始字节到 CSSOM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-render-tree"><span class="toc-text">The render tree</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lay’em-Out-and-Paint"><span class="toc-text">Lay’em Out and Paint</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaScript"><span class="toc-text">JavaScript</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#async-属性"><span class="toc-text">async 属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注意事项"><span class="toc-text">注意事项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DOM的重绘-Repaint-与回流-Reflow"><span class="toc-text">DOM的重绘(Repaint)与回流(Reflow)</span></a></li></ol></div></div><article id="post-others/browser-rendering" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><time class="article-date" datetime="2019-11-24T14:47:53.000Z" itemprop="datePublished">2019-11-24</time><div class="article-category"><a class="article-category-link" href="/blog/categories/others/">others</a></div></div><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Browser Rendering</h1></header><div class="article-entry" itemprop="articleBody"><h2 id="从-HTML-原始字节到-DOM"><a href="#从-HTML-原始字节到-DOM" class="headerlink" title="从 HTML 原始字节到 DOM"></a>从 HTML 原始字节到 DOM</h2><p>Bytes =&gt; Charaters =&gt; Tokens =&gt; Node =&gt; DOM</p><ul><li><p>what is <code>token</code>?</p><ul><li>Essentially, an html file is broken down into small units of parsing called tokens.This is how the browser begins to understand whate you’ve written.</li></ul></li><li><p><code>node</code> is a separate entity within the document object tree</p></li><li><p>The <code>DOM</code> establishes the parent-child relationships, adjacent sibling relationships etc.</p></li></ul><h2 id="从-CSS-原始字节到-CSSOM"><a href="#从-CSS-原始字节到-CSSOM" class="headerlink" title="从 CSS 原始字节到 CSSOM"></a>从 CSS 原始字节到 CSSOM</h2><p>浏览器是从 <code>html</code> 开始解析的，当发现 <code>link</code> 标签时，会开辟一个线程去发起请求取css文件数据。DOM 的构建仍会继续</p><p>生成 CSSOM 的过程与 DOM 一样<br>Bytes =&gt; Charaters =&gt; Tokens =&gt; Nodes =&gt; CSSOM</p><p>css 有时叫做 Cascade 是因为浏览器会迭代遍历 css 树结构来确定影响某个元素的样式（子元素的样式会受其父元素样式的影响）</p><h2 id="The-render-tree"><a href="#The-render-tree" class="headerlink" title="The render tree"></a>The render tree</h2><p>DOM 和 CSSOM 是两个独立的树形结构，DOM 包含有关页面HTML元素关系的所有信息，而 CSSOM 包含有关元素的样式信息。把 DOM 和 CSSOM 结合在一起就是 Render Tree</p><p>Render Tree 包含页面上所有可见 DOM 内容的信息，以及不同节点所需的所有 CSSOM 信息。<br>注意：<code>dispaly: none</code> 的元素不存在 Render Tree 中，但存在 DOM 中</p><h2 id="Lay’em-Out-and-Paint"><a href="#Lay’em-Out-and-Paint" class="headerlink" title="Lay’em Out and Paint"></a>Lay’em Out and Paint</h2><p>浏览器根据浏览器视窗计算每个元素的具体大小和位置，这个步骤考虑到从 DOM 和<br>CSSOM 接收到的内容和样式，并完成所有必要的布局计算，这个过程也叫做回流(reflow)</p><p>最后一步，就是把节点绘制到屏幕上</p><h2 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h2><ul><li><p>当解析器遇到 <code>script</code> 标签时，DOM 的构建会被停止，直到 script 代码执行完毕。当放到头部的 js 代码涉及到 DOM 操作时就会失败，这是因为body 标签及其内容还没有被解析到。这也是为什么 script 标签放到 body 标签底部的原因。</p></li><li><p>那么当解析到 script 标签，CSSOM 还没有准备好会怎样呢？</p><ul><li>The javascript execution will be halted until the CSSOM is ready.</li><li>With the CSSOM, the JS execution waits. No CSSOM, no JS execution.</li></ul></li></ul><h2 id="async-属性"><a href="#async-属性" class="headerlink" title="async 属性"></a>async 属性</h2><p>把 <code>async</code> 关键字添加到 <code>script</code> 标签, 其作用是：DOM 的构建不会停止，script 下载完成后执行</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://some-link-to-app.js"</span> <span class="attr">async</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol><li><p>DOM: Document Object Model, 浏览器将HTML解析成的树形数据结构。</p></li><li><p>CSSOM: CSS Object Model, 浏览器将CSS解析成的树形数据结构。</p></li><li><p>Render Tree: DOM 和 CSSOM 合并生成的Render Tree。</p></li><li><p>Layout: 计算出 Render Tree 每个节点的具体位置。</p></li><li><p>Painting: 通过显卡，将 Layout 后的节点内容分别呈现到屏幕上。</p></li></ol><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li><p>当我们浏览器获得HTML文件后，会自上而下的加载，并在加载过程中进行解析和渲染。</p></li><li><p>加载说的就是获取资源文件的过程，如果在加载过程中遇到外部CSS文件和图片，浏览器会另外发送一个请求，去获取CSS文件和相应的图片，这个请求是异步的，并不会影响HTML文件的加载。</p></li><li><p>但是如果遇到Javascript文件，HTML文件会挂起渲染的进程，等待JavaScript文件加载完毕后，再继续进行渲染。<br>为什么HTML需要等待JavaScript呢？因为JavaScript可能会修改DOM，导致后续HTML资源白白加载，所以HTML必须等待JavaScript文件加载完毕后，再继续渲染，这也就是为什么JavaScript文件在写在底部body标签前的原因。</p></li></ul><h2 id="DOM的重绘-Repaint-与回流-Reflow"><a href="#DOM的重绘-Repaint-与回流-Reflow" class="headerlink" title="DOM的重绘(Repaint)与回流(Reflow)"></a>DOM的重绘(Repaint)与回流(Reflow)</h2><ul><li><p>重绘：元素样式的改变（但宽度、大小、位置等不变）</p></li><li><p>回流：元素的大小或者位置发生了变化（当页面布局和几何信息发生变化时），触发了重新布局导致渲染树重新计算布局和渲染，还有，因为回流是根据视口的大小来计算元素的位置和大小的，所以浏览器的窗口尺寸变化也会引发回流</p></li></ul><p>注意：回流一定会触发重绘，而重绘不一定会回流</p><p>参考：<br><a href="https://blog.logrocket.com/" target="_blank" rel="noopener">https://blog.logrocket.com/</a> how-browser-rendering-works-behind-the-scenes-6782b0e8fb10/<br><a href="https://www.jianshu.com/p/05eb1b17b298" target="_blank" rel="noopener">https://www.jianshu.com/p/05eb1b17b298</a><br><a href="https://youtu.be/SmE4OwHztCc" target="_blank" rel="noopener">https://youtu.be/SmE4OwHztCc</a></p></div><footer class="article-footer"><a data-url="https://liserlzhy.github.io/2019/11/24/others/browser-rendering/" data-id="ck3h5zbl9000a1uph79be00ac" class="article-share-link">Share</a></footer></div><nav id="article-nav"><a href="/blog/2019/10/31/node/node-feature/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">Nodejs的特点</div></a></nav></article></div><section id="comments"><div id="gitalk-container"></div><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><div id="gitalk-container"></div><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script type="text/javascript">var gitalk=new Gitalk({clientID:"c384627b91fb67b4d945",clientSecret:"40bcd6212e102325b854bae964674349cc49d136",id:window.location.pathname,repo:"blog-comment",owner:"liserlzhy",admin:"liserlzhy"});gitalk.render("gitalk-container")</script></section><span id="toTopBtn" class="icon icon-angle-up"></span></div><footer id="footer"><div id="right-footer"><div id="social-media-footer"><ul><li><a href="https://github.com/liserlzhy/blog" target="_blank" rel="noopener" class="icon icon-github"></a></li></ul></div></div></footer></div></div><script src="/blog/js/jquery.min.js"></script><link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css"><script src="/blog/fancybox/jquery.fancybox.pack.js"></script><script src="/blog/js/script.js"></script><script src="/blog/js/search.js"></script><script type="text/javascript">var search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/blog/"+search_path;searchFunc(path,"slidedown-search-input","slidedown-search-result"),searchFunc(path,"nav-search-input","nav-search-result")</script></body><!-- rebuild by neat -->